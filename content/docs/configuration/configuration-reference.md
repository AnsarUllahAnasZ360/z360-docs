---
title: Configuration Reference
---

# Z360 VoIP — Complete Configuration Reference

> Generated by Teammate A, config-deployment-research team.
> All file paths are relative to the project root (`/Users/ansar/Documents/Z360/`).

---

## Table of Contents

1. [Telnyx Configuration](#1-telnyx-configuration)
2. [Firebase Configuration](#2-firebase-configuration)
3. [APNs Configuration](#3-apns-configuration)
4. [Capacitor Configuration](#4-capacitor-configuration)
5. [Laravel Configuration](#5-laravel-configuration)
6. [Android Build Config](#6-android-build-config)
7. [iOS Build Config](#7-ios-build-config)

---

## 1. TELNYX CONFIGURATION

All Telnyx values are defined in `config/cpaas.php` and sourced from environment variables in `.env.base` (lines 174–179).

### 1.1 `TELNYX_API_KEY`

| Attribute | Value |
|---|---|
| **What** | V2 API key for authenticating all server-side Telnyx REST API calls (SIP credential CRUD, call control commands, number provisioning, messaging profile management). |
| **Where** | `.env.base` line 175; consumed by `config/cpaas.php` line 5. Also used by the Telnyx PHP SDK internally (`vendor/telnyx/telnyx-php`). |
| **How to obtain** | Telnyx Portal → API Keys → Create API Key. Produces a `KEY…` string. |
| **Impact if missing/wrong** | **All server-side Telnyx operations fail** — no outbound calls, no SIP credential creation, no number provisioning, no messaging. The `telnyx:setup` artisan command will abort immediately (`.claude/skills/voip-backend/references/files.md` line 168). |
| **Dev vs Prod** | Same key can work in both if using a single Telnyx account. Most teams use separate Telnyx accounts (and thus separate keys) for dev vs production. |

### 1.2 `TELNYX_CALL_CONTROL_APP_ID`

| Attribute | Value |
|---|---|
| **What** | ID of the Telnyx Call Control Application. This application receives webhook events for all inbound/outbound voice calls (call.initiated, call.answered, call.hangup, etc.). The webhook URL is set to `{APP_URL}/webhooks/cpaas/telnyx/call-control`. |
| **Where** | `.env.base` line 178; consumed by `config/cpaas.php` line 6 as `call_control_id`. |
| **How to obtain** | Either manually via Telnyx Portal → Call Control → Applications, or automatically via `php artisan telnyx:setup call_control_id`. The setup command creates the application with the correct webhook URLs using `CPaaSService::tunnelSafeUrl()`. |
| **Impact if missing/wrong** | Inbound calls will not be routed to Z360. Outbound call control commands may fail. The call flow webhook pipeline breaks entirely. |
| **Dev vs Prod** | **Different per environment** — each environment needs its own call control app pointing to its own webhook URL. In development, ngrok tunnel URL is used via `NGROK_HOSTNAME`. |

### 1.3 `TELNYX_OUTBOUND_VOICE_PROFILE_ID` (OVP)

| Attribute | Value |
|---|---|
| **What** | Outbound Voice Profile ID. Controls outbound calling policies (CNAM, allowed destinations, etc.). Both the Call Control App and the Credential Connection reference this OVP. |
| **Where** | `.env.base` line 176; consumed by `config/cpaas.php` line 7 as `ovp_id`. |
| **How to obtain** | Telnyx Portal → Outbound Voice Profiles, or via `php artisan telnyx:setup ovp_id`. |
| **Impact if missing/wrong** | Outbound calls fail — neither call control nor credential-based (WebRTC) outbound calls can be placed without a valid OVP. |
| **Dev vs Prod** | Typically the same for both environments within the same Telnyx account. |

### 1.4 `TELNYX_CREDENTIAL_CONNECTION_ID`

| Attribute | Value |
|---|---|
| **What** | ID of the Telnyx Credential Connection. This is the parent "connection" under which per-user/per-device SIP credentials are created. It enables WebRTC-based calling from browsers and native apps. Webhook URL is set to `{APP_URL}/webhooks/cpaas/telnyx/credential`. |
| **Where** | `.env.base` line 177; consumed by `config/cpaas.php` line 8 as `credential_connection_id`. |
| **How to obtain** | Telnyx Portal → SIP Trunking → Credential Connections, or via `php artisan telnyx:setup credential_connection_id` (requires `ovp_id` to be set first). |
| **Impact if missing/wrong** | SIP credential creation fails → no WebRTC registration → no browser or native app calling. Per-device SIP credentials cannot be provisioned. The `CPaaSService::createTelnyxCredential()` method will fail. |
| **Dev vs Prod** | **Different per environment** — webhook URLs differ. |

### 1.5 `TELNYX_NOTIFICATIONS_PROFILE_ID`

| Attribute | Value |
|---|---|
| **What** | ID of the Telnyx Notification Profile. Telnyx uses this to send push notifications to mobile devices via FCM/APNs when an inbound call arrives on a SIP credential (the "Telnyx push" in the two-push system). The destination URL is set to `{APP_URL}/webhooks/cpaas/telnyx/notifications`. |
| **Where** | `.env.base` line 179; consumed by `config/cpaas.php` line 9 as `notifications_profile_id`. |
| **How to obtain** | Telnyx Portal → Notification Profiles, or via `php artisan telnyx:setup notifications`. The setup command creates a notification channel pointing to the correct webhook URL. |
| **Impact if missing/wrong** | The Telnyx SDK push for incoming calls will not fire — native mobile apps will not receive Telnyx-side push notifications. The "Z360 push" (server-side FCM/APNs) still works independently, but the two-push correlation will be one-sided. |
| **Dev vs Prod** | **Different per environment** — webhook URLs differ. |

### 1.6 `telnyx:setup` Artisan Command

| Attribute | Value |
|---|---|
| **What** | Automated setup command that creates all Telnyx resources (OVP, Credential Connection, Call Control App, Notification Profile). |
| **Where** | Defined in skill reference at `.claude/skills/voip-backend/references/files.md` line 149. |
| **Usage** | `php artisan telnyx:setup` (creates all), or `php artisan telnyx:setup {mode}` where mode is one of: `call_control_id`, `ovp_id`, `credential_connection_id`, `notifications`, `all`. Add `--force` to recreate even if IDs already exist. |
| **Prerequisite** | `TELNYX_API_KEY` must be set. For `credential_connection_id` and `call_control_id` modes, `ovp_id` must exist first. |

### 1.7 Tunnel Configuration (Development)

| Variable | Details |
|---|---|
| **`NGROK_AUTHTOKEN`** | ngrok authentication token for creating tunnels. Set in `.env.base` line 189. |
| **`NGROK_HOSTNAME`** | Custom ngrok hostname (e.g., `dev.z360.ngrok.io`). Set in `.env.base` line 190. Consumed by `config/app.php` line 129 as `tunnel_host`. |
| **How it works** | `CPaaSService::tunnelSafeUrl()` (`.claude/skills/voip-backend/references/files.md` line 4247) checks `config('app.tunnel_host')`. If set, all webhook URLs use the ngrok hostname instead of `APP_URL`. This is **critical** for development since Telnyx needs a publicly accessible URL for webhooks. |
| **Docker** | The ngrok service is defined in `docker-compose.yml` lines 166–181 under the `tunnel` profile. Start with `docker compose --profile tunnel up`. |
| **Impact if missing** | In development, Telnyx webhooks cannot reach the local server. Inbound calls, call events, and SMS webhooks will fail silently. |

---

## 2. FIREBASE CONFIGURATION

Firebase is used for: (a) FCM push notifications to Android devices, (b) iOS Firebase services (Analytics, Crashlytics), and (c) the Laravel backend's FCM HTTP v1 API calls.

### 2.1 Backend Firebase Configuration

#### `FIREBASE_CREDENTIALS`

| Attribute | Value |
|---|---|
| **What** | JSON-encoded Firebase service account credentials. Used by the `kreait/firebase-php` package (configured in `config/firebase.php` line 53) for the Firebase Admin SDK, and by `PushNotificationService` (line 300 in `app/Services/PushNotificationService.php`) for FCM HTTP v1 API access token generation. |
| **Where** | `.env.base` line 184. Consumed in two places: (1) `config/firebase.php` line 53 — `json_decode(env('FIREBASE_CREDENTIALS', '{}'), true)` — kreait SDK uses this. (2) `config/services.php` line 56 — path-based credentials for `PushNotificationService`. |
| **How to obtain** | Firebase Console → Project Settings → Service Accounts → Generate New Private Key. Download the JSON file. For `.env.base`, paste the entire JSON string as the value. |
| **Impact if missing/wrong** | **All FCM push notifications fail** — Android devices will not receive incoming call pushes, call-ended pushes, or any other server-initiated push notifications. The `PushNotificationService::getAccessToken()` will throw `RuntimeException: Firebase credentials file not found`. |
| **Dev vs Prod** | Can use the same Firebase project for both, or separate projects. The credentials file differs per project. |

#### `FIREBASE_PROJECT_ID`

| Attribute | Value |
|---|---|
| **What** | Firebase project ID (e.g., `z360-c7d9e`). Used to construct the FCM HTTP v1 API URL: `https://fcm.googleapis.com/v1/projects/{PROJECT_ID}/messages:send`. |
| **Where** | `config/services.php` line 55 — `env('FIREBASE_PROJECT_ID', 'z360-c7d9e')`. |
| **Impact if missing** | Falls back to default `z360-c7d9e`. If this is wrong, FCM API calls return 404 or 403. |

#### `FIREBASE_CREDENTIALS_PATH`

| Attribute | Value |
|---|---|
| **What** | File system path to the Firebase service account JSON file. Used by `PushNotificationService::getAccessToken()` to obtain OAuth2 tokens for FCM HTTP v1. |
| **Where** | `config/services.php` line 56 — defaults to `storage_path('z360-c7d9e-firebase-adminsdk-fbsvc-dca3e28ad0.json')`. The file is gitignored (`.gitignore` line 82: `storage/*-firebase-adminsdk-*.json`). |
| **Impact if missing** | `PushNotificationService` throws `RuntimeException: Firebase credentials file not found`. |

#### Other Firebase Config (config/firebase.php)

| Variable | Purpose |
|---|---|
| `FIREBASE_PROJECT` | Default Firebase project name (default: `app`). Line 12. |
| `FIREBASE_AUTH_TENANT_ID` | Firebase Auth tenant ID. Line 62. Not used for VoIP. |
| `FIREBASE_DATABASE_URL` | Realtime Database URL. Line 105. Not used for VoIP. |
| `FIREBASE_CACHE_STORE` | Cache store for Firebase SDK (default: `file`). Line 167. |
| `FIREBASE_HTTP_LOG_CHANNEL` | HTTP logging channel. Line 186. |

### 2.2 Android Firebase Configuration (`google-services.json`)

| Attribute | Value |
|---|---|
| **What** | Android Firebase configuration file containing API key, project ID, GCM sender ID, and app-specific config. Required for FCM, Crashlytics, Analytics, Performance Monitoring, and Remote Config. |
| **Where** | `android/app/google-services.json`. Gitignored (`.gitignore` line 83). |
| **How to obtain** | Firebase Console → Project Settings → Your apps → Android app → Download `google-services.json`. |
| **Impact if missing** | Build still succeeds (the `build.gradle` checks for its existence at line 142–148 and skips the google-services plugin if missing), but: FCM push notifications won't work, Crashlytics won't report, Analytics won't track. Logger outputs: `"google-services.json not found, google-services plugin not applied. Push Notifications won't work"`. |
| **Dev vs Prod** | Different file per Firebase project. The `applicationId` in the JSON must match `com.z360.app`. |

### 2.3 iOS Firebase Configuration (`GoogleService-Info.plist`)

| Attribute | Value |
|---|---|
| **What** | iOS Firebase configuration file. Contains API_KEY, GCM_SENDER_ID, PROJECT_ID, BUNDLE_ID, GOOGLE_APP_ID. Required for Firebase Messaging, Analytics, Crashlytics. |
| **Where** | `ios/App/App/GoogleService-Info.plist`. Currently **not gitignored** (tracked in repo with real values). |
| **How to obtain** | Firebase Console → Project Settings → Your apps → iOS app → Download `GoogleService-Info.plist`. |
| **Impact if missing/wrong** | iOS AppDelegate validates the plist on launch (`.claude/skills/voip-ios/references/files.md` line 10437). If it contains placeholder values or is missing, `FirebaseApp.configure()` is skipped, and Firebase services (Crashlytics, Analytics, FCM) are disabled. Warning logged: `"Firebase NOT configured - GoogleService-Info.plist contains placeholder values"`. |
| **Key values in current file** | `PROJECT_ID: z360-c7d9e`, `BUNDLE_ID: com.z360biz.app`, `GCM_SENDER_ID: 699830885674`. |

---

## 3. APNs CONFIGURATION

APNs VoIP push is used to wake iOS devices for incoming calls via PushKit. Configuration is in `config/services.php` lines 59–71.

### 3.1 `APNS_VOIP_ENABLED`

| Attribute | Value |
|---|---|
| **What** | Master toggle for APNs VoIP push sending. When `false`, `ApnsVoipService::sendVoipPush()` skips sending and logs a warning. |
| **Where** | `config/services.php` line 60. Default: `false`. |
| **Impact if false** | iOS devices will NOT receive the Z360-side VoIP push for incoming calls. They may still receive the Telnyx-side push (if notification profile is configured), but the two-push correlation system will be degraded. |
| **Dev vs Prod** | Set to `true` in production. In development, set to `true` only if APNs credentials are configured and you need to test iOS push. |

### 3.2 `APNS_VOIP_ENV`

| Attribute | Value |
|---|---|
| **What** | APNs environment: `development` or `production`. Determines the APNs gateway URL. |
| **Where** | `config/services.php` line 61. Default: `development`. |
| **How it works** | `development` → `https://api.sandbox.push.apple.com`, `production` → `https://api.push.apple.com`. Used in `ApnsVoipService::sendVoipPush()` at `app/Services/ApnsVoipService.php` line 37. |
| **Impact if wrong** | If set to `development` in production: push tokens from App Store builds will be rejected (sandbox tokens don't work on production gateway). If set to `production` in development: push tokens from Xcode debug builds will be rejected. |
| **Dev vs Prod** | **Must differ**: `development` for debug/TestFlight, `production` for App Store. |

### 3.3 `APNS_VOIP_BUNDLE_ID`

| Attribute | Value |
|---|---|
| **What** | The app's bundle identifier. Used to construct the APNs topic: `{bundle_id}.voip`. PushKit VoIP pushes require the `.voip` suffix on the topic. |
| **Where** | `config/services.php` line 62. |
| **Expected value** | `com.z360biz.app` (matching the Xcode project's `PRODUCT_BUNDLE_IDENTIFIER`). |
| **Impact if missing** | `ApnsVoipService::sendVoipPush()` returns `false` with warning: `"APNs VoIP push failed - missing bundle ID"`. |

### 3.4 Token-Based Authentication (Preferred)

| Variable | Details |
|---|---|
| **`APNS_VOIP_KEY_ID`** | The Key ID from Apple Developer Portal. 10-character alphanumeric string. `config/services.php` line 64. |
| **`APNS_VOIP_TEAM_ID`** | Apple Developer Team ID. 10-character alphanumeric string. `config/services.php` line 65. |
| **`APNS_VOIP_KEY_PATH`** | Filesystem path to the `.p8` APNs Auth Key file. `config/services.php` line 66. `.p8` files are gitignored (`.gitignore` line 68). |
| **How it works** | `ApnsVoipService::getJwt()` (line 127) creates an ES256 JWT signed with the `.p8` private key. The JWT contains `iss` (team_id) and `iat` (issued at). Cached for 50 minutes (line 173). |
| **Impact if any missing** | Falls back to certificate-based auth. If neither is configured, all APNs pushes fail. |

### 3.5 Certificate-Based Authentication (Fallback)

| Variable | Details |
|---|---|
| **`APNS_VOIP_CERT_PATH`** | Path to the VoIP push certificate `.pem` file. `config/services.php` line 68. |
| **`APNS_VOIP_CERT_PASSPHRASE`** | Passphrase for the certificate (if encrypted). `config/services.php` line 69. |
| **`APNS_VOIP_CERT_KEY_PATH`** | Path to the certificate's private key file (if separate). `config/services.php` line 70. |
| **How it works** | If token-based auth fields are empty, `ApnsVoipService` uses certificate-based auth via Guzzle's `cert` and `ssl_key` options (lines 82–86). Uses HTTP/2 (`CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_2_0`). |

### 3.6 APNs Architecture Notes

- **VoIP push topic**: Must be `{bundle_id}.voip` (e.g., `com.z360biz.app.voip`). This is automatic in `ApnsVoipService` line 38.
- **Push priority**: Always `10` (immediate) for VoIP calls (line 44).
- **Expiration**: `0` (deliver immediately, don't store) for time-sensitive call notifications (line 43).
- **Collapse ID**: Set to `callSessionId` to prevent duplicate notifications for the same call (line 48).
- **PushKit on iOS**: The iOS app registers for PushKit VoIP pushes via `PKPushRegistry` (`.claude/skills/voip-ios/references/files.md` line 997). The device token is sent to the backend and stored in `UserDeviceToken`.

---

## 4. CAPACITOR CONFIGURATION

### 4.1 `capacitor.config.ts`

| Setting | Value | Details |
|---|---|---|
| `appId` | `com.z360.app` | Must match Android `applicationId` in `build.gradle` (line 24). Note: iOS uses `com.z360biz.app` — there is a **mismatch** between Capacitor config and iOS bundle ID. |
| `appName` | `Z360` | Display name used by Capacitor. |
| `webDir` | `public` | Directory containing the built web assets. |
| `appendUserAgent` | `Z360Capacitor` | Appended to WebView's user agent. Used for platform detection. |

### 4.2 `CAPACITOR_SERVER_URL`

| Attribute | Value |
|---|---|
| **What** | URL that the mobile app's WebView loads. In development, points to the dev server so hot-reload works. In production, the WebView loads bundled assets from `webDir`. |
| **Where** | `.env.base` line 17. Default: `https://dev.z360.cloud`. Consumed by `capacitor.config.ts` lines 22–47. |
| **How it works** | If set, the config generates a `server` block with `url`, `cleartext` (http allowed in dev), and `androidScheme`. If not set, `server` is `undefined` and Capacitor loads from local files. |
| **Dev vs Prod** | Set to dev server URL (e.g., `https://dev.z360.cloud` or `http://192.168.1.x:7360`) in development. **Unset or remove** for production builds (so the app uses bundled assets). |

### 4.3 Platform-Specific Overrides

**iOS** (`capacitor.config.ts` lines 48–53):
| Setting | Value | Purpose |
|---|---|---|
| `contentInset` | `never` | Prevents double safe-area insets when using CSS `env(safe-area-inset-*)`. |
| `backgroundColor` | `#FFFFFF` | Prevents white flash on launch and keyboard corners. |

**Android** (`capacitor.config.ts` lines 54–59):
| Setting | Value | Purpose |
|---|---|---|
| `buildOptions.keystorePath` | `undefined` | Keystore configured separately in `build.gradle`. |
| `buildOptions.keystoreAlias` | `undefined` | Same as above. |

### 4.4 Plugin Configuration

| Plugin | Setting | Details |
|---|---|---|
| **StatusBar** | `overlaysWebView: true, style: 'DEFAULT'` | Status bar overlays content. |
| **Keyboard** | `resize: KeyboardResize.None, resizeOnFullScreen: true` | Keyboard does not resize viewport (handled by CSS). |
| **PushNotifications** | `presentationOptions: ['badge', 'sound']` | Foreground notifications show badge and sound. `alert` is intentionally omitted — foreground display is handled via `LocalNotifications` instead (supports tap-to-navigate). |

### 4.5 Capacitor Plugin Dependencies

**SPM (iOS)** — `ios/App/CapApp-SPM/Package.swift`:
- `capacitor-swift-pm` 8.0.0
- `@capacitor/browser` 8.0.0
- `@capacitor/keyboard` 8.0.0
- `@capacitor/local-notifications` 8.0.0
- `@capacitor/push-notifications` 8.0.0
- `@capacitor/status-bar` 8.0.0

Note: Telnyx iOS SDK and Firebase iOS SDK are added as **direct Xcode SPM dependencies**, not through Capacitor's plugin system (see [iOS Build Config](#7-ios-build-config)).

---

## 5. LARAVEL CONFIGURATION

### 5.1 Database (PostgreSQL)

| Variable | Default | File | Notes |
|---|---|---|---|
| `DB_CONNECTION` | `pgsql` | `.env.base` line 50, `config/database.php` | Must be `pgsql`. |
| `DB_HOST` | `pgsql` | `.env.base` line 51 | Docker service name. In production, Aurora endpoint. |
| `DB_PORT` | `5432` | `.env.base` line 52 | Standard PostgreSQL port. |
| `DB_USERNAME` | `appuser` | `.env.base` line 53 | |
| `DB_PASSWORD` | `appsecret` | `.env.base` line 54 | |
| `DB_DATABASE` | `z360` | `.env.base` line 55 | |
| `DB_SECRET` | `"{}"` | `.env.base` line 56 | JSON format for Aurora auto-rotation. When set with valid JSON containing `host`, `port`, `dbname`, `username`, `password` fields, these override the individual `DB_*` env vars (`config/database.php` lines 5–17). |

**VoIP relevance**: The `user_device_tokens` table stores FCM tokens, APNs VoIP tokens, SIP credentials, and device metadata. The `telephony_credentials` table stores per-user/per-device Telnyx SIP credentials. Call records are stored in the `messages` table.

### 5.2 Redis / Valkey

| Variable | Default | File | Notes |
|---|---|---|---|
| `REDIS_CLIENT` | `phpredis` | `.env.base` line 120 | PHP extension-based client. |
| `REDIS_HOST` | `valkey` | `.env.base` line 122 | Docker service name. Z360 uses Valkey (Redis-compatible). |
| `REDIS_PORT` | `6379` | `.env.base` line 124 | |
| `REDIS_PASSWORD` | `null` | `.env.base` line 123 | |

**VoIP relevance**: Redis/Valkey is **critical** for:
- **Simultaneous ring distributed locking**: `Cache::lock("simring:{$parentId}:lock", 10)` — ensures only one device can answer an incoming call across all ring targets (`.claude/skills/voip-backend/references/files.md` lines 2057, 2259).
- **Queue processing**: All VoIP-related jobs (push notifications, call recording, etc.) go through the Redis queue.
- **Session storage**: User auth sessions stored in Redis.

### 5.3 Cache

| Variable | Default | File | Notes |
|---|---|---|---|
| `CACHE_STORE` | `redis` | `.env.base` line 112 | Must be `redis` for simring locking to work (atomic distributed locks). |

**Impact if not redis**: `Cache::lock()` with file or array drivers is **not distributed** — simring coordination across multiple workers will fail, potentially allowing multiple devices to answer the same call.

### 5.4 Queue

| Variable | Default | File | Notes |
|---|---|---|---|
| `QUEUE_CONNECTION` | `redis` | `.env.base` line 78, `config/queue.php` | |

**Docker**: Queue worker runs as a separate container (`docker-compose.yml` line 32): `php artisan queue:listen`.

**VoIP relevance**: Push notification sending, call event processing, and webhook handling are dispatched as queued jobs.

### 5.5 Broadcasting / Reverb WebSocket

Reverb provides real-time WebSocket communication for the frontend. Three-layer configuration:

#### Server Layer (where Reverb runs)

| Variable | Default | Purpose |
|---|---|---|
| `REVERB_SERVER_HOST` | `0.0.0.0` | Bind address inside Docker container. |
| `REVERB_SERVER_PORT` | `8080` | Internal port. |
| `REVERB_SERVER_PATH` | `` (empty) | Base path. Production uses `/reverb` since it shares port 443. |

#### App-to-Server Layer (how Laravel talks to Reverb)

| Variable | Default | Purpose |
|---|---|---|
| `REVERB_HOST` | `reverb` | Docker service name. |
| `REVERB_PORT` | `8080` | Internal port. |
| `REVERB_SCHEME` | `http` | Protocol. `https` in production. |
| `REVERB_APP_ID` | `z360-app` | Application identifier. |
| `REVERB_APP_KEY` | `z360-reverb-key` | Authentication key. |
| `REVERB_APP_SECRET` | `z360-reverb-secret` | Authentication secret. |

#### Frontend-to-Server Layer (how browser/app talks to Reverb)

| Variable | Default | Purpose |
|---|---|---|
| `VITE_REVERB_APP_KEY` | `${REVERB_APP_KEY}` | Exposed to frontend via Vite. |
| `VITE_REVERB_HOST` | `127.0.0.1` | Frontend connects to localhost in dev. |
| `VITE_REVERB_PORT` | `7361` | Mapped port (Docker maps 7361→8080). |
| `VITE_REVERB_SCHEME` | `${REVERB_SCHEME}` | `http` in dev, `https` in prod. |
| `VITE_REVERB_PATH` | `${REVERB_PATH}` | Base path. |

**Docker**: Reverb runs as a separate container (`docker-compose.yml` line 52): `php artisan reverb:start`, exposed on port 7361.

**VoIP relevance**: Reverb is one of the three channels for call dismissal in simultaneous ringing (SIP BYE + Reverb WebSocket + push notification). Real-time call state updates are broadcast via Reverb.

### 5.6 Broadcasting Config

| Variable | Default | File |
|---|---|---|
| `BROADCAST_CONNECTION` | `reverb` | `.env.base` line 83, `config/broadcasting.php` |

The Reverb connection in `config/broadcasting.php` (lines 33–50) uses `REVERB_APP_KEY`, `REVERB_APP_SECRET`, `REVERB_APP_ID`, `REVERB_HOST`, `REVERB_PORT`, `REVERB_SCHEME`, and optionally `REVERB_PATH`.

---

## 6. ANDROID BUILD CONFIG

### 6.1 SDK Versions (`android/variables.gradle`)

| Setting | Value | Notes |
|---|---|---|
| `minSdkVersion` | 24 (Android 7.0) | Required for WebRTC and Telecom framework. |
| `compileSdkVersion` | 36 | Latest Android SDK. |
| `targetSdkVersion` | 36 | Targets latest API level. |
| `kotlinVersion` | `1.9.24` | Pinned — Telnyx SDK requires 1.9.x (version 3.3.0 has credential auth bug, using 3.2.0). |
| `cordovaAndroidVersion` | `14.0.1` | Required by Capacitor. |

### 6.2 Java/Kotlin Compatibility

| Setting | Value | Source |
|---|---|---|
| `sourceCompatibility` | Java 17 | `build.gradle` line 44 |
| `targetCompatibility` | Java 17 | `build.gradle` line 45 |
| `jvmTarget` | `17` | `build.gradle` line 48 |

The root `build.gradle` (lines 31–45) forces Java 17 and Kotlin JVM target across **all modules** to resolve conflicts with Capacitor-generated configs that default to Java 21.

### 6.3 Dependencies (VoIP-specific)

| Dependency | Version | Purpose |
|---|---|---|
| `com.github.team-telnyx:telnyx-webrtc-android` | `3.2.0` | Telnyx WebRTC SDK. **Note**: Version 3.3.0 has a credential authentication bug (comment on line 109). |
| `project(':telnyx_common')` | local | Official Telnyx common module (TelnyxViewModel, CallForegroundService, etc.). |
| `com.google.firebase:firebase-bom` | `33.7.0` | Firebase BOM for consistent versions. |
| `firebase-messaging-ktx` | BOM-managed | FCM push notifications. |
| `firebase-analytics-ktx` | BOM-managed | Call event tracking. |
| `firebase-crashlytics-ktx` | BOM-managed | Error reporting. |
| `firebase-perf-ktx` | BOM-managed | Call setup latency tracking. |
| `firebase-config-ktx` | BOM-managed | Remote Config for runtime behavior changes. |
| `kotlinx-coroutines-core` | `1.7.3` | **Force-pinned** to avoid Telnyx SDK conflicts. |
| `kotlinx-coroutines-android` | `1.7.3` | Same as above. |
| `androidx.lifecycle:lifecycle-runtime-ktx` | `2.6.2` | StateFlow observation (SDK-aligned). |
| `androidx.lifecycle:lifecycle-process` | `2.6.2` | Process-level scope (survives activity destruction). |
| `io.coil-kt:coil` | `2.6.0` | Contact avatar loading for call UI. |
| `com.google.android.material:material` | `1.12.0` | Material 3 for call screen UI. |
| `androidx.constraintlayout:constraintlayout` | `2.1.4` | IncomingCallActivity layout. |
| `com.google.code.gson:gson` | `2.10.1` | Parsing Telnyx SDK push metadata. |

### 6.4 Kotlin Resolution Strategy

The app `build.gradle` (lines 60–72) forces consistent Kotlin and coroutines versions across all transitive dependencies to prevent conflicts between AGP 9.0 (which pulls Kotlin 2.0+) and the Telnyx SDK (which needs 1.9.x).

### 6.5 Gradle Plugins

| Plugin | Version | Source |
|---|---|---|
| `com.android.tools.build:gradle` | `8.13.2` | Root `build.gradle` line 12 |
| `com.google.gms:google-services` | `4.4.4` | Root `build.gradle` line 13 |
| `com.google.firebase:firebase-crashlytics-gradle` | `3.0.3` | Root `build.gradle` line 14 |
| `com.google.firebase:perf-plugin` | `1.4.2` | Root `build.gradle` line 15 |
| `kotlin-gradle-plugin` | `1.9.24` | Root `build.gradle` line 16 |
| `com.google.devtools.ksp` | `1.9.24-1.0.20` | `telnyx_common/build.gradle` line 4 (for Room) |

### 6.6 AndroidManifest.xml Permissions

**Core** (`android/app/src/main/AndroidManifest.xml`):
| Permission | Line | Purpose |
|---|---|---|
| `INTERNET` | 5 | Network access for WebRTC. |
| `ACCESS_NETWORK_STATE` | 6 | Network state monitoring. |

**VoIP** (from Telnyx demo pattern):
| Permission | Line | Purpose |
|---|---|---|
| `RECORD_AUDIO` | 9 | Microphone access for calls. **Runtime permission required.** |
| `MODIFY_AUDIO_SETTINGS` | 10 | Audio routing (speaker/earpiece/bluetooth). |
| `READ_PHONE_STATE` | 11 | Phone state awareness. |
| `CALL_PHONE` | 12 | System dialer integration. |

**Notifications**:
| Permission | Line | Purpose |
|---|---|---|
| `POST_NOTIFICATIONS` | 15 | Android 13+ notification permission. **Runtime permission required.** |
| `VIBRATE` | 16 | Vibration for incoming calls. |
| `USE_FULL_SCREEN_INTENT` | 17 | Full-screen incoming call UI when locked. |

**Background Services**:
| Permission | Line | Purpose |
|---|---|---|
| `FOREGROUND_SERVICE` | 20 | Required for foreground services. |
| `FOREGROUND_SERVICE_PHONE_CALL` | 21 | Phone call foreground service type. |
| `FOREGROUND_SERVICE_MICROPHONE` | 22 | Microphone foreground service type. |
| `WAKE_LOCK` | 23 | Keep CPU awake during calls. |

**Telecom Framework**:
| Permission | Line | Purpose |
|---|---|---|
| `MANAGE_OWN_CALLS` | 26 | Self-managed ConnectionService. |

**Bluetooth**:
| Permission | Line | Purpose |
|---|---|---|
| `BLUETOOTH` (max SDK 30) | 29 | Legacy bluetooth for audio routing. |
| `BLUETOOTH_CONNECT` | 30 | Android 12+ bluetooth connection. |

### 6.7 AndroidManifest.xml Services & Components

| Component | Class | Purpose |
|---|---|---|
| **Z360FirebaseMessagingService** | `.fcm.Z360FirebaseMessagingService` | Handles both Z360 FCM and Telnyx push messages. Priority 10000. |
| **LegacyCallNotificationService** | `com.telnyx.webrtc.common.notification.LegacyCallNotificationService` | Telnyx common call notification (foreground service, phoneCall type). |
| **CallForegroundService** | `com.telnyx.webrtc.common.service.CallForegroundService` | Active call foreground service (phoneCall + microphone). Runs in `:call_service` process. |
| **CallNotificationReceiver** | `com.telnyx.webrtc.common.notification.CallNotificationReceiver` | Handles notification actions (answer/decline). |
| **BackgroundCallDeclineService** | `com.telnyx.webrtc.common.notification.BackgroundCallDeclineService` | Handles call decline from background state. |
| **Z360ConnectionService** | `.voip.Z360ConnectionService` | Self-managed Telecom ConnectionService. Requires `BIND_TELECOM_CONNECTION_SERVICE` permission. |
| **IncomingCallActivity** | `.voip.IncomingCallActivity` | Full-screen incoming call UI. `showWhenLocked=true`, `turnScreenOn=true`. |
| **ActiveCallActivity** | `.voip.ActiveCallActivity` | Active call UI. `showWhenLocked=true`. |

### 6.8 Firebase Metadata

| Metadata | Value | Line | Purpose |
|---|---|---|---|
| `default_notification_color` | `@color/white` | 154 | Default FCM notification color. |
| `default_notification_channel_id` | `telnyx_call_notification_channel` | 158 | Routes default FCM notifications to Telnyx call channel. |

### 6.9 Signing Configuration

| Item | Details |
|---|---|
| **Keystore properties** | Read from `android/keystore.properties` (lines 6–10 of app `build.gradle`). File does NOT exist in repo (not committed). |
| **Properties format** | `storeFile`, `storePassword`, `keyAlias`, `keyPassword`. |
| **Debug signing** | Uses default Android debug keystore. |
| **Release signing** | Only enabled if `keystore.properties` exists and `storeFile` is set (line 38). |

### 6.10 Repositories

| Repository | Purpose |
|---|---|
| `google()` | Google's Maven repository (Firebase, AndroidX). |
| `mavenCentral()` | Standard Maven Central. |
| `maven { url 'https://jitpack.io' }` | Required for Telnyx SDK (`com.github.team-telnyx`). |

---

## 7. iOS BUILD CONFIG

### 7.1 Xcode Project Settings

| Setting | Value | Source |
|---|---|---|
| **Bundle ID** | `com.z360biz.app` | `project.pbxproj` line 635. Note: differs from Capacitor's `com.z360.app`. |
| **Development Team** | `K3H6JK29AN` | `project.pbxproj` line 533. Apple Developer Team ID. |
| **Deployment Target** | iOS 15.0 | `project.pbxproj` line 551, `CapApp-SPM/Package.swift` line 7 (`.iOS(.v15)`). |
| **Swift Tools** | 5.9 | `CapApp-SPM/Package.swift` line 1. |

### 7.2 Info.plist (`ios/App/App/Info.plist`)

#### UIBackgroundModes (lines 27–33)

| Mode | Purpose |
|---|---|
| `voip` | **Critical**: Enables PushKit VoIP push notifications. Without this, the app cannot receive VoIP pushes. |
| `audio` | Allows audio playback during calls when app is backgrounded. |
| `remote-notification` | Enables silent remote notifications (for FCM data messages). |
| `fetch` | Background fetch capability. |

#### Usage Descriptions

| Key | Value | Line |
|---|---|---|
| `NSMicrophoneUsageDescription` | "Z360 needs access to your microphone to make and receive phone calls." | 77 |
| `NSCameraUsageDescription` | "Z360 needs access to your camera for video calls." | 79 |

**Impact if missing**: App will crash at runtime when requesting microphone permission without the usage description.

#### App Transport Security (lines 80–86)

| Key | Value | Purpose |
|---|---|---|
| `NSAllowsArbitraryLoads` | `true` | Allows HTTP connections (needed for dev server). |
| `NSAllowsArbitraryLoadsInWebContent` | `true` | Same for WebView content. |

**Dev vs Prod**: Should be restricted in production to only allow HTTPS, with exceptions for specific domains if needed.

#### Scene Configuration (lines 57–75)

Uses `UIApplicationSceneManifest` with `SceneDelegate` for lifecycle management. This is important for VoIP because the **two-phase startup** relies on `sceneDidBecomeActive` to defer heavy initialization (Phase 2) after PushKit/CallKit processing (Phase 1).

### 7.3 App.entitlements (`ios/App/App/App.entitlements`)

| Entitlement | Value | Purpose |
|---|---|---|
| `aps-environment` | `development` | APNs push notification environment. **Must be `production` for App Store builds.** |

**Impact if wrong**: Push notifications will be delivered to the wrong APNs gateway, causing delivery failures. This value is typically overridden by the provisioning profile during signing.

**Missing entitlements that may be needed**:
- `com.apple.developer.pushkit.unrestricted-voip` — Not present. May be needed if Apple restricts VoIP push usage for non-primary VoIP apps (Apple reviews this during App Store submission).

### 7.4 SPM Dependencies (via Xcode project)

| Package | Version | Source |
|---|---|---|
| `telnyx-webrtc-ios` | `2.4.0` | `https://github.com/team-telnyx/telnyx-webrtc-ios` |
| `firebase-ios-sdk` | `11.15.0` | `https://github.com/firebase/firebase-ios-sdk` |
| `capacitor-swift-pm` | `8.0.0` | `https://github.com/ionic-team/capacitor-swift-pm.git` |
| `Starscream` | `4.0.8` | WebSocket library (Telnyx dependency). |
| `WebRTC` | `139.0.0` | WebRTC framework (Telnyx dependency). |

**Firebase frameworks linked** (from `project.pbxproj`):
- `FirebaseMessaging` — Push notifications
- `FirebaseCrashlytics` — Crash reporting
- `FirebaseAnalytics` — Event tracking

### 7.5 iOS Native VoIP Source Files

| File | Path (relative to `ios/App/App/`) | Purpose |
|---|---|---|
| `Z360VoIPService.swift` | VoIP/ | Main VoIP orchestrator |
| `CallKitManager.swift` | VoIP/ | CallKit integration |
| `PushKitManager.swift` | VoIP/ | PushKit VoIP push handling |
| `TelnyxService.swift` | VoIP/ | Telnyx SDK wrapper |
| `TelnyxServiceDelegate.swift` | VoIP/ | Telnyx SDK delegate |
| `TelnyxVoipPlugin.swift` | VoIP/ | Capacitor plugin bridge |
| `AudioManager.swift` | VoIP/ | Audio session management |
| `SceneDelegate.swift` | Root | Two-phase startup orchestration |
| `AppDelegate.swift` | Root | Firebase init, PushKit registration |

### 7.6 Signing Requirements

| Item | Details |
|---|---|
| **Provisioning Profile** | Must include: Push Notifications capability, VoIP Push capability (PushKit). |
| **Certificate** | Apple Development or Distribution certificate matching Team ID `K3H6JK29AN`. |
| **Entitlements** | Must match the provisioning profile's capabilities. `aps-environment` must match target environment. |

### 7.7 iOS Capacitor Plugin Configuration

Capacitor plugins are managed via SPM in `ios/App/CapApp-SPM/Package.swift`:
- `CapacitorBrowser` 8.0.0
- `CapacitorKeyboard` 8.0.0
- `CapacitorLocalNotifications` 8.0.0
- `CapacitorPushNotifications` 8.0.0
- `CapacitorStatusBar` 8.0.0

Note: The Telnyx native VoIP layer is **not** a Capacitor plugin in the SPM sense — it's added as direct Swift source files and communicates with the web layer via the custom `TelnyxVoipPlugin` Capacitor bridge.

---

## APPENDIX: Configuration Value Quick Reference

### Environment Variables Summary (`.env.base`)

| Variable | Section | Required for VoIP | Dev Value | Prod Value |
|---|---|---|---|---|
| `TELNYX_API_KEY` | Telnyx | Yes | Telnyx API key | Same or different account key |
| `TELNYX_CALL_CONTROL_APP_ID` | Telnyx | Yes | Auto-generated per env | Different per env |
| `TELNYX_OUTBOUND_VOICE_PROFILE_ID` | Telnyx | Yes | Auto-generated | Same or different |
| `TELNYX_CREDENTIAL_CONNECTION_ID` | Telnyx | Yes | Auto-generated per env | Different per env |
| `TELNYX_NOTIFICATIONS_PROFILE_ID` | Telnyx | Yes | Auto-generated per env | Different per env |
| `FIREBASE_CREDENTIALS` | Firebase | Yes (Android push) | Service account JSON | Same or different project |
| `FIREBASE_PROJECT_ID` | Firebase | Yes | `z360-c7d9e` | Project ID |
| `APNS_VOIP_ENABLED` | APNs | Yes (iOS push) | `false` or `true` | `true` |
| `APNS_VOIP_ENV` | APNs | Yes (iOS push) | `development` | `production` |
| `APNS_VOIP_BUNDLE_ID` | APNs | Yes (iOS push) | `com.z360biz.app` | `com.z360biz.app` |
| `APNS_VOIP_KEY_ID` | APNs | Yes (iOS push, token auth) | Apple Key ID | Same |
| `APNS_VOIP_TEAM_ID` | APNs | Yes (iOS push, token auth) | `K3H6JK29AN` | Same |
| `APNS_VOIP_KEY_PATH` | APNs | Yes (iOS push, token auth) | Path to `.p8` file | Path to `.p8` file |
| `CAPACITOR_SERVER_URL` | Capacitor | No (dev only) | `https://dev.z360.cloud` | Unset |
| `NGROK_AUTHTOKEN` | Tunnel | Dev only | ngrok token | N/A |
| `NGROK_HOSTNAME` | Tunnel | Dev only | ngrok hostname | N/A |
| `CACHE_STORE` | Laravel | Yes (simring) | `redis` | `redis` |
| `QUEUE_CONNECTION` | Laravel | Yes (async jobs) | `redis` | `redis` |
| `BROADCAST_CONNECTION` | Laravel | Yes (real-time) | `reverb` | `reverb` |
| `REVERB_APP_KEY` | Reverb | Yes (WebSocket) | `z360-reverb-key` | Secure random |
| `REVERB_APP_SECRET` | Reverb | Yes (WebSocket) | `z360-reverb-secret` | Secure random |

### Files That Must Exist (Not in Git)

| File | Platform | Gitignored | Purpose |
|---|---|---|---|
| `storage/*-firebase-adminsdk-*.json` | Backend | Yes | Firebase service account credentials |
| `android/app/google-services.json` | Android | Yes | Firebase Android configuration |
| `*.p8` (APNs auth key) | Backend | Yes | APNs token-based authentication |
| `android/keystore.properties` | Android | No (not present) | Release signing configuration |

### Files That Exist in Git (Sensitive)

| File | Platform | Contains Secrets | Notes |
|---|---|---|---|
| `ios/App/App/GoogleService-Info.plist` | iOS | API keys | Currently tracked. Contains real Firebase config (API_KEY, GCM_SENDER_ID). Consider gitignoring. |
| `.env.base` | All | Partial | Contains Stripe test keys. VoIP keys are empty placeholders. |
